{% extends "base.html" %}
{% load static %}
{% block head_title %}게임 리스트 | Piro Card Game{% endblock %}
{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/game_list.css' %}">
{% endblock %}
{% block content %}
<div class="game-list-container-kds">
    <div class="game-history-kds">
        <h3 class="game-history-title-kds">History List</h3>
        <div class="current-player-kds">현재 플레이어 : <b>{{ user.username }}</b></div>
        <ul class="game-history-list-kds">
            {% for game, _ in my_attacks %}
                <li class="game-history-item-kds">
                    <span class="game-number-kds">{{ forloop.counter }}</span>
                    <span class="game-vs-kds">{{ game.attacker.username }} VS {{ game.defender.username }}</span>
                </li>
            {% endfor %}
        </ul>
        <h3 class="game-history-title-kds">내가 수비자인 게임</h3>
        <ul class="game-history-list-kds">
            {% for game, can_counter in my_defenses %}
                <li class="game-history-item-kds">
                    <span class="game-vs-kds">{{ game.attacker.username }} VS {{ game.defender.username }}</span>
                    {% if game.status == 'COMPLETED' %}
                        <span class="game-result-kds">
                            결과: 
                            {% if game.is_draw %}
                                무승부
                            {% elif game.winner == user %}
                                승리! (점수: {{ game.defender_score_change }})
                            {% else %}
                                패배 (점수: {{ game.defender_score_change }})
                            {% endif %}
                            <br>
                            내 카드: {{ game.defender_card }}, 상대 카드: {{ game.attacker_card }}
                        </span>
                    {% elif can_counter %}
                        <form action="{% url 'counter_attack' game.id %}" method="get" style="display:inline;">
                            <button class="game-info-btn-kds" type="submit">CounterAttack</button>
                        </form>
                    {% else %}
                        <span class="game-status-kds">CounterAttack 대기중</span>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </div>
    <div class="game-detail-kds">
        <div class="counterattack-header-kds">CounterAttack</div>
        <ul class="game-detail-list-kds">
            {% for game, can_counter in my_attacks %}
                <li class="game-detail-item-kds">
                    <span class="game-vs-kds">{{ game.attacker.username }} VS {{ game.defender.username }}</span>
                    {% if game.status == 'COMPLETED' %}
                        <span class="game-result-kds">
                            결과: 
                            {% if game.is_draw %}
                                무승부
                            {% elif game.winner == user %}
                                승리! (점수: {{ game.attacker_score_change }})
                            {% else %}
                                패배 (점수: {{ game.attacker_score_change }})
                            {% endif %}
                            <br>
                            내 카드: {{ game.attacker_card }}, 상대 카드: {{ game.defender_card }}
                        </span>
                    {% elif game.attacker == user %}
                        <span class="game-status-kds">진행 중..</span>
                    {% elif game.defender == user and can_counter %}
                        <form action="{% url 'counter_attack' game.id %}" method="get" style="display:inline;">
                            <button class="game-info-btn-kds" type="submit">CounterAttack</button>
                        </form>
                    {% else %}
                        <span class="game-status-kds">CounterAttack 대기중</span>
                    {% endif %}
                    <button class="game-info-btn-kds">게임정보</button>
                </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
